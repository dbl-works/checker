#!/usr/bin/env ruby

require_relative '../lib/dbl_checker/manager/client'
require_relative '../lib/dbl_checker/manager/healthz'

environment = ENV['RAILS_ENV'] || 'development'

client_pid = fork do
  `export RAILS_ENV=#{environment}`
  DblChecker::Manager::Client.new.run
end

puts "started manager with pid: #{client_pid}"

DblChecker::Manager::Healthz.new.serve(client_pid)
